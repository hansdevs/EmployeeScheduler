{% extends "base.html" %}
{% block content %}
<h2>Official Schedule</h2>

{% if not is_published %}
<div class="alert alert-warning">
  This schedule is not yet published!
</div>
{% endif %}

<!-- Show business info at top -->
<div class="mb-3">
  <h5>{{ business.name }}</h5>
  <p class="mb-1">Industry: {{ business.industry }}</p>
  <p class="mb-1">Requirements: {{ business.requirements|join(', ') }}</p>
</div>

<!-- Show each day 0..6, each station's assigned employees & times -->
{% for d in range(7) %}
  <h4>Day {{ d }} ({{ ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][d] }})</h4>

  {% set dayShifts = schedule|selectattr("day","equalto",d)|list %}
  {% if dayShifts %}
    <!-- We'll group them by station_id -->
    {% for st in stations %}
      <!-- find shifts for this station+day -->
      {% set stShifts = dayShifts|selectattr("station_id","equalto",st.id)|list %}
      <h5>{{ st.name }} (Station #{{ st.id }})</h5>
      {% if stShifts %}
        <ul class="list-group mb-2">
          {% for sh in stShifts %}
            {% set emp = employees|selectattr("id","equalto",sh.employee_id)|list|first %}
            <li class="list-group-item">
              <strong>
                {% if emp %}{{ emp.name }}{% else %}Employee #{{ sh.employee_id }}{% endif %}
              </strong>
              from {{ "%02d"|format(sh.start) }}:00 to {{ "%02d"|format(sh.end) }}:00
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted ms-4">No shifts for this station</p>
      {% endif %}
    {% endfor %}
  {% else %}
    <p>No shifts for Day {{ d }}.</p>
  {% endif %}
{% endfor %}
{% endblock %}
